  

---

### **üîç Introduction**

- In the last session, we explored **Hibernate** and its role in persisting data.
- Today, we will focus on **Spring Data JPA**, which is built on top of JPA and simplifies database access.
- **Key Concept:** Spring Data JPA **automates DAO method creation** using repositories, eliminating the need for writing SQL queries manually.

---

### **üìñ What is Spring Data JPA?**

‚úÖ **Spring Data JPA** is a part of the larger **Spring Data ecosystem**, providing:

- A **higher-level abstraction** for JPA-based repositories.
- Automatic query generation, reducing boilerplate code.
- Built-in repository support for common database operations.
- Support for custom queries (JPQL & SQL).

‚úÖ **Why use it?**

- No need to write SQL queries.
- Reduces development effort.
- Provides **out-of-the-box** pagination and sorting.
- Simplifies **data management** with minimal effort.

---

### **üóÇÔ∏è Types of Repositories in Spring Data JPA**

Spring Data JPA provides different repository interfaces to simplify data operations:

|   |   |
|---|---|
|Repository Type|Purpose|
|`**Repository<T, ID>**`|Basic repository, no methods defined.|
|`**CrudRepository<T, ID>**`|Provides CRUD (Create, Read, Update, Delete) operations.|
|`**PagingAndSortingRepository<T, ID>**`|Adds support for **pagination and sorting**.|
|`**JpaRepository<T, ID>**`|Extends `CrudRepository` and `PagingAndSortingRepository`.|

üîπ **Best Practice:** Use `**JpaRepository<T, ID>**` as it inherits methods from both `CrudRepository` and `PagingAndSortingRepository`.

---

### **üõ† Creating a Repository in Spring Data JPA**

üìå **Steps to create a repository:**

1Ô∏è‚É£ **Create an Entity:**

```Java
@Entity
public class ProductEntity {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String title;
    private BigDecimal price;
    private Integer quantity;
    private String sku;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

2Ô∏è‚É£ **Define a Repository Interface:**

```Java
@Repository
public interface ProductRepository extends JpaRepository<ProductEntity, Long> {
}
```

üöÄ **No need to implement CRUD methods manually!** The framework will generate them automatically.

---

### **üßê How Spring Data JPA Generates Implementation?**

- We **only define the interface**, but who implements these methods?
- The answer is `**SimpleJpaRepository**`, which is an internal class that provides implementations for repository methods.

---

## **üí° Spring Data JPA - Query Methods**

Spring Data JPA allows us to define **custom query methods** just by following naming conventions.

### **üîπ Query Derivation Rules**

1Ô∏è‚É£ Method names must start with:

- `findBy`, `readBy`, `queryBy`, or `getBy`.
- Example: `findByTitle(String title)` ‚Üí Generates `SELECT * FROM product WHERE title = ?`.

2Ô∏è‚É£ Use **logical operators** (`And`, `Or`):

- `findByTitleAndPrice(String title, BigDecimal price)`
- `findByTitleOrPrice(String title, BigDecimal price)`

3Ô∏è‚É£ Use **Comparison Operators**:

- `findByPriceGreaterThan(BigDecimal price)`
- `findByPriceLessThan(BigDecimal price)`
- `findByCreatedAtAfter(LocalDateTime date)`

4Ô∏è‚É£ Use **Sorting & Pagination**:

- `findByTitleOrderByPriceAsc(String title)`

---

### **üîç Example: Custom Query Methods**

### ‚úÖ **Fetching data based on conditions**

```Java
// Finds all products with a title
List<ProductEntity> findByTitle(String title);

// Finds all products with price greater than 100
List<ProductEntity> findByPriceGreaterThan(BigDecimal price);

// Finds all products where quantity is between 10 and 50
List<ProductEntity> findByQuantityBetween(int minQty, int maxQty);
```

### ‚úÖ **Fetching data using LIKE (Pattern Matching)**

```Java

// Finds all products where title contains "Choco"
List<ProductEntity> findByTitleContaining(String keyword);
```

### ‚úÖ **Ignore Case in Queries**

```Java
// Finds all products where title contains a word, case-insensitive
List<ProductEntity> findByTitleContainingIgnoreCase(String keyword);
```

### ‚úÖ **Check Existence**

```Java
// Checks if a product exists by title
boolean existsByTitle(String title);
```

---

## **üìå Writing JPQL Queries using @Query Annotation**

When predefined method names are **not enough**, we can use `@Query`.

### **üîπ Example: Fetch product by title and price**

```Java
@Query("SELECT p FROM ProductEntity p WHERE p.title = :title AND p.price = :price")
Optional<ProductEntity> findByTitleAndPrice(@Param("title") String title, @Param("price") BigDecimal price);
```

---

## **üìù Running JPA Repository in Tests**

We can test JPA repositories using **Spring Boot's test framework**.

### ‚úÖ **Example: Saving Data**

```Java
@Autowired
private ProductRepository productRepository;

@Test
void testSaveProduct() {
    ProductEntity product = ProductEntity.builder()
        .title("Nestle Chocolate")
        .price(new BigDecimal("123.45"))
        .quantity(12)
        .sku("NESTLE234")
        .build();

    ProductEntity savedProduct = productRepository.save(product);
    System.out.println("Saved Product: " + savedProduct);
}
```

### ‚úÖ **Example: Fetching Data**

```Java
@Test
void testFindProductByTitle() {
    List<ProductEntity> products = productRepository.findByTitle("Nestle Chocolate");
    products.forEach(System.out::println);
}
```

---

## **üìä Pagination & Sorting in Spring Data JPA**

Spring Data JPA provides **pagination** and **sorting** out of the box.

### ‚úÖ **Paginated Fetching**

```Java

Page<ProductEntity> findAll(Pageable pageable);
```

### ‚úÖ **Usage Example**

```Java
Page<ProductEntity> page = productRepository.findAll(PageRequest.of(0, 10, Sort.by("price").ascending()));
```

---

## **‚úÖ Summary (Quick Interview Revision)**

### **1Ô∏è‚É£ What is Spring Data JPA?**

- A **wrapper** around JPA that simplifies database access.
- Uses **repositories** to reduce boilerplate code.

### **2Ô∏è‚É£ Different Repositories in Spring Data JPA**

|   |   |
|---|---|
|Repository Type|Purpose|
|`CrudRepository`|Basic CRUD operations|
|`PagingAndSortingRepository`|Adds pagination and sorting|
|`JpaRepository`|Adds extra JPA-specific methods|

### **3Ô∏è‚É£ Query Methods & Naming Conventions**

|   |   |
|---|---|
|Query Type|Example|
|**Find by attribute**|`findByTitle(String title)`|
|**Find with conditions**|`findByPriceGreaterThan(BigDecimal price)`|
|**Find with LIKE**|`findByTitleContaining(String keyword)`|
|**Ignore Case**|`findByTitleContainingIgnoreCase(String keyword)`|
|**Check Existence**|`existsByTitle(String title)`|

### **4Ô∏è‚É£ JPQL Queries**

|   |   |
|---|---|
|Query Type|Example|
|Fetch with conditions|`@Query("SELECT p FROM ProductEntity p WHERE p.title = :title")`|
|Find with multiple conditions|`findByTitleAndPrice(String title, BigDecimal price)`|

### **5Ô∏è‚É£ Key Benefits of Spring Data JPA**

‚úÖ Eliminates need to write SQL.

‚úÖ Supports **pagination and sorting**.

‚úÖ Provides **automatic query generation**.

‚úÖ Allows writing **custom JPQL & SQL queries**.

---

üí° **Next Topic**: **Pagination & Sorting in Spring Data JPA**

üìå **Homework:** Try out different method names to generate queries automatically.

üöÄ **Stay tuned for advanced Spring Data JPA concepts in the next class!** üî•