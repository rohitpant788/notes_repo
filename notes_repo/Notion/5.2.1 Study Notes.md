## **🔹 Introduction to Spring Security**

- **Spring Security** is a powerful framework for securing Java applications.
- It supports various authentication mechanisms:
    - **Username & Password Authentication**
    - **Two-Factor Authentication**
    - **OAuth Security**
    - **Multiple Token-based Security**
- Spring Security uses multiple **providers, managers, and filters** to ensure a **robust security layer**.

---

## **🔹 Adding Spring Security to a Spring Boot Application**

To integrate Spring Security, add the following dependency:

```XML
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

- This enables **Spring Security Auto-Configuration** with **sensible defaults** defined in the **Web Security Configuration class**.

---

## **🔹 Authentication vs Authorization (🔑 Key Concept)**

|   |   |   |
|---|---|---|
|**Concept**|**Definition**|**Example**|
|**Authentication**|Verifies the **identity** of the user.|🔹 At a society’s entrance, proving you live there by showing a badge.|
|**Authorization**|Determines if a **user has permission** to perform an action.|🔹 You can enter your home, but you cannot enter someone else’s home.|

📌 **Authentication ensures who you are, Authorization ensures what you can do.**

---

## **🔹 Spring Security Default Behavior**

Once you add Spring Security, the following **default configurations** are applied:

✅ **Spring Security Filter Chain**

- A bean that intercepts all HTTP requests.
- Acts as a gateway between the **client** and the **server**.

✅ **HTTP Basic Authentication**

- Enables a default **username/password authentication mechanism**.

✅ **Auto-Generated Login Form**

- A login page is created automatically where users can enter credentials.

✅ **Default User Account**

- **Username:** `user`
- **Password:** (Generated and displayed in the console)

✅ **Password Encryption using Bcrypt**

- **Passwords are hashed** using **Bcrypt** to ensure security.

✅ **CSRF Protection Enabled**

- Prevents **Cross-Site Request Forgery (CSRF) attacks** by including a **CSRF token** in requests.

✅ **Session Management**

- Spring Security **maintains session data** to prevent re-authentication on each request.

✅ **Logout Mechanism**

- Users can **logout via** `/logout` endpoint.

---

## **🔹 Security Filter Chain – The Core of Spring Security**

Spring Security follows a **filter-based approach** where **every request passes through a chain of filters**.

🔹 **Analogy**: Think of it as a **water filtration system** – each filter processes different contaminants before the water is considered clean.

### **🛠️ How Requests Flow Through Security Filters**

1️⃣ A **client request** enters the application.

2️⃣ It first encounters **Spring Security Filter Chain**.

3️⃣ The request then passes through multiple filters, such as:

- **CORS Filter** (Handles cross-origin requests)
- **CSRF Filter** (Prevents CSRF attacks)
- **Logout Filter** (Manages user logouts)
- **UsernamePasswordAuthenticationFilter** (Handles username & password authentication)
- **BearerTokenAuthorizationFilter** (Handles JWT-based authentication)  
      
    

4️⃣ **Custom Filters** can be added at **specific points** in the chain.

📌 **Spring Security has around 17-18 filters, each handling a specific task.**

---

## **🔹 Understanding Authentication Flow**

1️⃣ **Client submits login request** with username & password.

2️⃣ **Security Filter Chain triggers authentication process.**

3️⃣ **Spring delegates authentication to** `AuthenticationManager`.

4️⃣ `AuthenticationManager` selects an **Authentication Provider** based on the login type:

- **DAO Authentication Provider** (For database-backed authentication)
- **In-Memory Authentication Provider** (For hardcoded credentials)
- **OAuth Authentication Provider** (For external login like Google, Facebook)  
    5️⃣ If the authentication is successful:  
    
- The **user's details** (username, roles) are **stored in SecurityContext**.
- A **session is created** (or JWT token is generated for stateless authentication).  
    6️⃣ If authentication fails:  
    
- The request is **rejected** with a `401 Unauthorized` error.

🔹 **Example**:

```Java
@Bean
public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception {
    return authConfig.getAuthenticationManager();
}
```

---

## **🔹 Spring Security Context & Session Handling**

- After authentication, Spring Security **stores user details in the Security Context**.
- **Session ID (**`**JSESSIONID**`**) is used to track user sessions.**
- The **session expires** when:
    - User logs out (`/logout` endpoint)
    - Server restarts
    - Session timeout occurs

🔹 **To check session details in the browser:**  
1️⃣ Open **Developer Tools (F12)**.

2️⃣ Go to **Application > Cookies > JSESSIONID**.

3️⃣ The session ID is **invalidated on logout**, preventing unauthorized access.

---

## **🔹 Cross-Site Request Forgery (CSRF) Protection**

- **CSRF Tokens** prevent unauthorized requests from being executed on behalf of an authenticated user.
- **CSRF token is passed with each request**, ensuring that only trusted sources can perform actions.

📌 **Example:**

When submitting the login form, a hidden CSRF token is included:

```HTML
<input type="hidden" name="_csrf" value="random-token-value" />
```

---

## **🔹 Customizing Security Configuration**

- Instead of using the default username and password, we can define custom credentials:

🔹 **Modify** `**application.properties**`

```Plain
spring.security.user.name=mini
spring.security.user.password=pass123
```

🔹 **Disable Default Security Configuration and Implement Custom Security**

```Java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .anyRequest().authenticated()
            )
            .formLogin(withDefaults());
        return http.build();
    }
}
```

---

## **🔹 Summary (Quick Interview Revision)**

|   |   |
|---|---|
|🔹 **Concept**|🔹 **Explanation**|
|**Authentication**|Verifying user identity (Username & Password).|
|**Authorization**|Checking permissions to access resources.|
|**Spring Security Dependency**|`spring-boot-starter-security`|
|**Default Behavior**|Auto-login form, default user, bcrypt password hashing.|
|**Security Filter Chain**|Filters requests before reaching the controller.|
|**Authentication Flow**|Request → Filters → Authentication Manager → UserDetailsService → Security Context.|
|**Session ID (**`**JSESSIONID**`**)**|Manages user sessions.|
|**CSRF Protection**|Prevents unauthorized actions.|
|**Custom Security Configuration**|Implement own login/logout APIs, JWT-based authentication.|

---