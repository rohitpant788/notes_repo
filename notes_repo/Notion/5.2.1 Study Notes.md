## **ğŸ”¹ Introduction to Spring Security**

- **Spring Security** is a powerful framework for securing Java applications.
- It supports various authentication mechanisms:
    - **Username & Password Authentication**
    - **Two-Factor Authentication**
    - **OAuth Security**
    - **Multiple Token-based Security**
- Spring Security uses multiple **providers, managers, and filters** to ensure a **robust security layer**.

---

## **ğŸ”¹ Adding Spring Security to a Spring Boot Application**

To integrate Spring Security, add the following dependency:

```XML
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

- This enables **Spring Security Auto-Configuration** with **sensible defaults** defined in the **Web Security Configuration class**.

---

## **ğŸ”¹ Authentication vs Authorization (ğŸ”‘ Key Concept)**

|   |   |   |
|---|---|---|
|**Concept**|**Definition**|**Example**|
|**Authentication**|Verifies the **identity** of the user.|ğŸ”¹ At a societyâ€™s entrance, proving you live there by showing a badge.|
|**Authorization**|Determines if a **user has permission** to perform an action.|ğŸ”¹ You can enter your home, but you cannot enter someone elseâ€™s home.|

ğŸ“Œ **Authentication ensures who you are, Authorization ensures what you can do.**

---

## **ğŸ”¹ Spring Security Default Behavior**

Once you add Spring Security, the following **default configurations** are applied:

âœ… **Spring Security Filter Chain**

- A bean that intercepts all HTTP requests.
- Acts as a gateway between the **client** and the **server**.

âœ… **HTTP Basic Authentication**

- Enables a default **username/password authentication mechanism**.

âœ… **Auto-Generated Login Form**

- A login page is created automatically where users can enter credentials.

âœ… **Default User Account**

- **Username:** `user`
- **Password:** (Generated and displayed in the console)

âœ… **Password Encryption using Bcrypt**

- **Passwords are hashed** using **Bcrypt** to ensure security.

âœ… **CSRF Protection Enabled**

- Prevents **Cross-Site Request Forgery (CSRF) attacks** by including a **CSRF token** in requests.

âœ… **Session Management**

- Spring Security **maintains session data** to prevent re-authentication on each request.

âœ… **Logout Mechanism**

- Users can **logout via** `/logout` endpoint.

---

## **ğŸ”¹ Security Filter Chain â€“ The Core of Spring Security**

Spring Security follows a **filter-based approach** where **every request passes through a chain of filters**.

ğŸ”¹ **Analogy**: Think of it as a **water filtration system** â€“ each filter processes different contaminants before the water is considered clean.

### **ğŸ› ï¸ How Requests Flow Through Security Filters**

1ï¸âƒ£ A **client request** enters the application.

2ï¸âƒ£ It first encounters **Spring Security Filter Chain**.

3ï¸âƒ£ The request then passes through multiple filters, such as:

- **CORS Filter** (Handles cross-origin requests)
- **CSRF Filter** (Prevents CSRF attacks)
- **Logout Filter** (Manages user logouts)
- **UsernamePasswordAuthenticationFilter** (Handles username & password authentication)
- **BearerTokenAuthorizationFilter** (Handles JWT-based authentication)  
      
    

4ï¸âƒ£ **Custom Filters** can be added at **specific points** in the chain.

ğŸ“Œ **Spring Security has around 17-18 filters, each handling a specific task.**

---

## **ğŸ”¹ Understanding Authentication Flow**

1ï¸âƒ£ **Client submits login request** with username & password.

2ï¸âƒ£ **Security Filter Chain triggers authentication process.**

3ï¸âƒ£ **Spring delegates authentication to** `AuthenticationManager`.

4ï¸âƒ£ `AuthenticationManager` selects an **Authentication Provider** based on the login type:

- **DAO Authentication Provider** (For database-backed authentication)
- **In-Memory Authentication Provider** (For hardcoded credentials)
- **OAuth Authentication Provider** (For external login like Google, Facebook)  
    5ï¸âƒ£ If the authentication is successful:  
    
- The **user's details** (username, roles) are **stored in SecurityContext**.
- A **session is created** (or JWT token is generated for stateless authentication).  
    6ï¸âƒ£ If authentication fails:  
    
- The request is **rejected** with a `401 Unauthorized` error.

ğŸ”¹ **Example**:

```Java
@Bean
public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception {
    return authConfig.getAuthenticationManager();
}
```

---

## **ğŸ”¹ Spring Security Context & Session Handling**

- After authentication, Spring Security **stores user details in the Security Context**.
- **Session ID (**`**JSESSIONID**`**) is used to track user sessions.**
- The **session expires** when:
    - User logs out (`/logout` endpoint)
    - Server restarts
    - Session timeout occurs

ğŸ”¹ **To check session details in the browser:**  
1ï¸âƒ£ Open **Developer Tools (F12)**.

2ï¸âƒ£ Go to **Application > Cookies > JSESSIONID**.

3ï¸âƒ£ The session ID is **invalidated on logout**, preventing unauthorized access.

---

## **ğŸ”¹ Cross-Site Request Forgery (CSRF) Protection**

- **CSRF Tokens** prevent unauthorized requests from being executed on behalf of an authenticated user.
- **CSRF token is passed with each request**, ensuring that only trusted sources can perform actions.

ğŸ“Œ **Example:**

When submitting the login form, a hidden CSRF token is included:

```HTML
<input type="hidden" name="_csrf" value="random-token-value" />
```

---

## **ğŸ”¹ Customizing Security Configuration**

- Instead of using the default username and password, we can define custom credentials:

ğŸ”¹ **Modify** `**application.properties**`

```Plain
spring.security.user.name=mini
spring.security.user.password=pass123
```

ğŸ”¹ **Disable Default Security Configuration and Implement Custom Security**

```Java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .anyRequest().authenticated()
            )
            .formLogin(withDefaults());
        return http.build();
    }
}
```

---

## **ğŸ”¹ Summary (Quick Interview Revision)**

|   |   |
|---|---|
|ğŸ”¹ **Concept**|ğŸ”¹ **Explanation**|
|**Authentication**|Verifying user identity (Username & Password).|
|**Authorization**|Checking permissions to access resources.|
|**Spring Security Dependency**|`spring-boot-starter-security`|
|**Default Behavior**|Auto-login form, default user, bcrypt password hashing.|
|**Security Filter Chain**|Filters requests before reaching the controller.|
|**Authentication Flow**|Request â†’ Filters â†’ Authentication Manager â†’ UserDetailsService â†’ Security Context.|
|**Session ID (**`**JSESSIONID**`**)**|Manages user sessions.|
|**CSRF Protection**|Prevents unauthorized actions.|
|**Custom Security Configuration**|Implement own login/logout APIs, JWT-based authentication.|

---