# **Spring Boot – Persistence Layer (Spring Data JPA & H2 Database)**

## **Introduction**

- We have explored the **presentation layer** in our Spring Boot Starter Web Dependency project.
- Now, we move to the **persistence layer** – where all database operations happen.
- We will take an **introductory look** at this layer before diving deeper into **Spring Data JPA** in the upcoming modules.

---

# **Java Persistence API (JPA) & Hibernate**

## **1. What is JPA?**

- JPA stands for **Java Persistence API** (now called **Jakarta Persistence API**).
- JPA is a **specification** that defines how Java applications interact with databases.
- Hibernate is the most commonly used **JPA provider** (implementation of JPA).

### **Other JPA Providers**

- Hibernate
- OpenJPA
- EclipseLink

### **Why Use JPA Instead of Direct JDBC?**

|   |   |
|---|---|
|**JDBC (Java Database Connectivity)**|**JPA (Java Persistence API)**|
|Requires **manual SQL queries**|Uses **object-relational mapping (ORM)**|
|Developer must write **boilerplate** SQL code|JPA **abstracts SQL** and manages queries|
|No automatic mapping between Java objects and tables|**Automatic mapping** between Java objects & tables|
|Manually handles database connections|JPA manages **connections & transactions**|

---

## **2. What is Hibernate?**

- Hibernate is an **ORM (Object-Relational Mapping) framework** and acts as a **JPA provider**.
- It provides **an abstraction layer** over SQL by **mapping Java objects to database tables**.
- Hibernate **auto-generates SQL queries** and executes them.

### **Key Features of Hibernate**

✅ **ORM Mapping** – Converts Java objects into relational database tables.

✅ **Optimized Queries** – Translates **JPQL (Java Persistence Query Language)** to **SQL**.

✅ **Automatic Table Creation** – Creates and manages tables based on Java entities.

### **Hibernate vs. JPA**

|   |   |   |
|---|---|---|
|**Feature**|**JPA**|**Hibernate**|
|Definition|A **specification** (API)|An **implementation** of JPA|
|Query Language|Uses **JPQL**|Uses **HQL (Hibernate Query Language)**|
|Configuration|Requires a **JPA provider**|Works **independently** as ORM|

---

## **3. JDBC & Hibernate Workflow**

1️⃣ **Database Connection via JDBC Drivers**

2️⃣ **JPA Manages Database Operations**

3️⃣ **Hibernate Performs ORM Mapping**

4️⃣ **Spring Data JPA Provides Repositories for CRUD Operations**

---

# **Spring Data JPA – Working with Entities**

## **1. Defining an Entity Class**

- Entities represent **database tables**.
- Use `@Entity` annotation to define an entity class.
- Example:

```Java

@Entity
@Table(name = "employees")
public class Employee {

  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  private Long id;

  private String name;
  private String email;

  // Getters, Setters, Constructors
}

```

### **Annotations Used:**

|   |   |
|---|---|
|Annotation|Description|
|`@Entity`|Marks a class as an entity|
|`@Table(name = "employees")`|Specifies table name|
|`@Id`|Defines the primary key|
|`@GeneratedValue(strategy = GenerationType.AUTO)`|Auto-generates ID values|

---

## **2. Repository Layer – CRUD Operations**

- The **repository layer** interacts with the database.
- Use **Spring Data JPA** to simplify database operations.

### **Creating a Repository**

```Java

@Repository
public interface EmployeeRepository extends JpaRepository<Employee, Long> {
}

```

### **Key Benefits of** `**JpaRepository**`

✅ **Predefined Methods** – `save()`, `findById()`, `findAll()`, `deleteById()`.

✅ **Auto-implemented CRUD operations** – No need to write SQL queries.

✅ **Supports Custom Queries** – We can define methods like `findByName()`.

---

## **3. Using Repository in Controller**

```Java

@RestController
@RequestMapping("/employees")
public class EmployeeController {

    private final EmployeeRepository employeeRepository;

    @Autowired
    public EmployeeController(EmployeeRepository employeeRepository) {
        this.employeeRepository = employeeRepository;
    }

    @GetMapping("/{id}")
    public Employee getEmployeeById(@PathVariable Long id) {
        return employeeRepository.findById(id).orElse(null);
    }

    @PostMapping
    public Employee createEmployee(@RequestBody Employee employee) {
        return employeeRepository.save(employee);
    }
}

```

### **Key Points:**

✅ Inject `EmployeeRepository` using `@Autowired`.

✅ Use `findById()` to fetch employee data.

✅ Use `save()` to persist employee data.

---

# **Using H2 Database in Spring Boot**

## **1. What is H2 Database?**

- H2 is an **in-memory relational database**.
- Used for **testing & development** without needing an actual database.
- **Data is lost** when the application stops unless persisted to a file.

## **2. Adding H2 Dependency**

Add H2 to `pom.xml`:

```XML

<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>

```

## **3. Configuring H2 in** `**application.properties**`

```Plain

spring.datasource.url=jdbc:h2:file:./data/db
spring.datasource.username=admin
spring.datasource.password=admin123
spring.h2.console.enabled=true
spring.jpa.hibernate.ddl-auto=update

```

### **Key Configurations**

✅ `spring.h2.console.enabled=true` – Enables **H2 Console UI**.

✅ `spring.datasource.url=jdbc:h2:file:./data/db` – Persists data in a file.

✅ `spring.jpa.hibernate.ddl-auto=update` – Ensures tables are not dropped.

## **4. Accessing H2 Console**

- Run the application.
- Open: `http://localhost:8080/h2-console`
- Enter:
    - **JDBC URL:** `jdbc:h2:file:./data/db`
    - **Username:** `admin`
    - **Password:** `admin123`
- Click **Connect** to view tables.

---

# **Lombok – Simplifying Boilerplate Code**

## **1. What is Lombok?**

- A Java library to reduce **boilerplate code**.
- Eliminates the need to write **getters, setters, constructors** manually.

## **2. Adding Lombok Dependency**

```XML
xml
CopyEdit
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <scope>provided</scope>
</dependency>

```

## **3. Using Lombok Annotations**

|   |   |
|---|---|
|**Annotation**|**Description**|
|`@Getter`|Generates getter methods|
|`@Setter`|Generates setter methods|
|`@AllArgsConstructor`|Generates constructor with all fields|
|`@NoArgsConstructor`|Generates no-arg constructor|

### **Example with Lombok**

```Java
java
CopyEdit
@Entity
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class Employee {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    private String name;
    private String email;
}

```

---

# **Summary – Quick Revision**

✅ **JPA** is a specification, Hibernate is an implementation of JPA.

✅ **Spring Data JPA** simplifies database operations using `JpaRepository`.

✅ **Entities** represent database tables (`@Entity`).

✅ **H2 Database** is used for testing (`spring.h2.console.enabled=true`).

✅ **Lombok** reduces boilerplate code (`@Getter`, `@Setter`).

✅ **Controller calls Repository**, which interacts with **Database**.

✅ **H2 Console** provides a UI to query data (`http://localhost:8080/h2-console`).